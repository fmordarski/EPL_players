---
title: "Raport dotyczący statystyk piłkarzy ligi angielskiej"
author: "Filip Mordarski 76671"
date: "2 12 2020"
header-includes:
  - \usepackage[polish]{babel}
output: 
  pdf_document:
toc: true
toc_depth: 2
number_sections: true
---

```{r, include=FALSE, echo=FALSE, warning=FALSE}
rm(list=ls())
library(dplyr)
library(ggplot2)
library(lattice)
library(latticeExtra)
library(viridis)
library(tidyverse)
library(gridExtra)
library(fmsb)
library(scales)
library(reshape2)
library(papeR)
library(knitr)
knitr::opts_chunk$set(fig.align = "center",  warning = F, message = F) 
# setwd("C:/Users/Uzytkownik/Documents/Studia/prezentacja i wizualizacja/projekt/EPL_players")
setwd("C:/Users/filip-mordarski/priv/EPL_players")

data1 <- read.csv("pl_19-20.csv", encoding = "UTF-8", stringsAsFactors = FALSE,
                  strip.white=TRUE)
data1$Name <- substr(data1$Name, 1, length(data1$Name)-1)
data <- data1%>%filter(Appearances!=0)
data[data$Position=='Goalkeeper', 'Position'] <- 'Bramkarz'
data[data$Position=='Defender', 'Position'] <- 'Obrońca'
data[data$Position=='Midfielder', 'Position'] <- 'Pomocnik'
data[data$Position=='Forward', 'Position'] <- 'Napastnik'
data$Passes <- as.numeric(sub(",", "", data$Passes, fixed = TRUE))

summary <- data %>% select(Name, Position, Appearances, Goals.conceded, Goals, Shots, Clean.sheets, Saves, Errors.leading.to.goal, Passes, Accurate.long.balls, High.Claims, Tackles, Blocked.shots, Duels.won, Duels.lost, Big.chances.created, Assists, Crosses, Interceptions, Clearances, Aerial.battles.won, Aerial.battles.lost, Headed.goals)

names(summary) <- c("Nazwisko", "Pozycja", "Występy", "Stracone bramki", "Gole", "Strzały", "Czyste konta", "Obronione strzały", "Błędy prowadzące do straty bramki",
                    "Podania", "Długie piłki", "Złapane wysokie piłki", "Wślizgi", "Zablokowane strzały", "Wygrane pojedynki", "Przegrane pojedynki",
                    "Stworzone okazje", "Asysty", "Crossy", "Przechwyty", "Wybicia piłki", "Wygrane pojedynki powietrzne", "Przegrane pojedynki powietrzne",
                    "Gole głową")

summary$Pozycja <- as.factor(summary$Pozycja)
```
\newpage
# Wstęp

Celem niniejszego raportu jest analiza statystyk zawodników, występujących w najwyższej klasie męskich rozgrywek piłkarskich w Anglii w sezonie 2019/2020. Może on okazać się bardzo wartościowy dla trenerów, którym pomoże w poprawianiu jakości gry swojego zespołu. Taki raport z pewnością okaże się korzystny podczas budowania kadry pierwszego zespołu na kolejny sezon. Umożliwi wyszukanie zawodników o charakterystyce pasującej do gry danego zespołu.

# Opis zbioru danych

Poniższy rozdział będzie poświęcony opisowi zbioru danych oraz jego statystykom opisowym. Zbiór danych, wykorzystany do przeprowadzenia analizy pochodzi z następującej strony internetowej: https://www.kaggle.com/krishanthbarkav/english-premier-leagueepl-player-statistics. Został on utworzony na podstawie statystyk zawodników, występujących w najwyższej klasie męskich rozgrywek piłkarskich w Anglii w sezonie 2019/2020. Zbiór danych zawiera 974 obserwacji oraz 54 zmienne. Jedna obserwacja, odpowiada jednemu zawodnikowi oraz jego statystykom z całego sezonu 2019/2020. Analiza będzie obejmować tylko zawodników, którzy wystąpili przynajmniej raz podczas całego sezonu. Z tego powodu analizowany zbiór danych liczy 474 obserwacji. 

Zbiór danych zawiera bardzo dużo zmiennych, aż 54. Przedstawianie statystyk opisowych każdej z nich jest zbędne i nie byłoby wartościowe. Z tego względu zostaną przedstawione jedynie statystyki tych zmiennych, które będą wykorzystane w dalszej analizie.

```{r, echo=F, results='asis'}
kable(summarize(summary, type = "numeric"))
```

\newpage
```{r, echo=F, results='asis'}
kable(summarize(summary, type = "factor"))
```

# Wstępna analiza statystyk zawodników

Poniższy rozdział będzie zawierał analizę ogólnych statystyk zawodników z wszystkich pozycji na boisku. W pierwszej kolejności został przedstawiony histogram pozycji zawodników.

```{r ,echo = FALSE, warning=FALSE}
ggplot(aes(Position), data=data)+
  geom_histogram(fill=viridis(10)[3], stat='count')+
  labs(title='Histogram pozycji zawodników', x='Pozycja', y='Liczba piłkarzy')+
  theme_bw()
```

Jak widać na powyższym wykresie, najczęstszą pozycją zawodników jest pomocnik. Porównywalną ilość stanowią obrońcy. Najmniej w lidze angielskiej jest bramkarzy. Jest to dosyć naturalne, ponieważ w meczu w jednej drużynie gra tylko jeden bramkarz. Relatywnie mało jest również napastników. Drużyny często grają w systemie z jednym lub dwoma napastnikami, dlatego ta pozycja nie jest tak mocna obsadzona jak obrona czy pomoc. Następnie został utworzony histogram występów zawodników w podziale na pozycje.

```{r ,echo = FALSE}
histogram(~Appearances|Position, data=data, col=viridis(10)[4], breaks = 10, 
          xlab = 'Liczba występów', main='Histogram występów zawodników', ylab = 'Procent w danej grupie')
```

Na podstawie powyższego wykresu można zauważyć, że aż 30 % bramkarzy wystąpiło w 35 - 40 meczach. Jest to największy procent wśród pozycji zawodników. Na podstawie tego można wysnuć wniosek, że drużyny rzadziej decydują się zmieniać bramkarzy w podstawowym składzie niż zawodników z innych pozycji. Na innych pozycjach wartości dla danych zakresów występów są podobne. Ciekawy przypadek występuje wśród napastników, którzy zagrali 30 - 35 meczy. Jest ich prawie 20 % wśród innych zawodników na tej pozycji. Również ta wartość może sugerować, że trenerzy raczej nie są skorzy do zmiany podstawowych napastników w ciągu całego sezonu. Prawdopodobnie najważniejszą statystyką wśród piłkarzy są zdobyte przez nich bramki. To one decydują o ostatecznym wyniku. Przeanalizowano więc zależność pomiędzy zdobytymi bramkami a oddanymi strzałami w zależności od pozycji zawodnika. W tej analizie nie zostaną uwzględnieni bramkarze, ponieważ żaden z nich nie zdobył w tym sezonie bramki.

```{r, echo=FALSE}
xyplot(Goals ~ Shots | Position, data=data%>%filter(Position!='Bramkarz'),
       layout=c(3, 1), aspect=2, xlab = 'Strzały', ylab = 'Gole', main='Zależność goli od strzałów w podziale na pozycje wraz z linią regresji',
       panel=function(x, y) {
	     panel.lmline(x, y)
       panel.xyplot(x, y, col=viridis(10)[4], pch=19)
       })
```

Powyższy wykres dostarcza wniosków, które dla nawet poczatkującego fana piłki nożnej wydadzą się dość naturalne i oczywiste. W pierwszej kolejności, wystepuje pozytywna korelacja pomiędzy ilością bramek a strzałami. Na wykresie można zauważyć, że najwięcej bramek zdobywali napastnicy. Co ciekawe, nachylenie linii regresji jest wyższa niż u pomocników, co sugeruje że wraz ze zwiększeniem liczby strzałów o jeden, ilość bramek wzrasta szybciej u napastników niż u pomocników. Jak można się było również spodziewać, ilość bramek zdobytych przez obrońców jest znikoma. 

# Bramkarze

Powszechnie wiadomo, że bramkarze są odpowiedzialni za bronienie dostępu do własnej bramki. Z tego względu, nie ma wielu statystyk dotyczącego tego aspektu gry. Poniższy rozdział będzie zawierał analizę takich elementów jak, ilość czystych kont, liczba straconych bramek, błędy prowadzące do utraty bramki, czy liczba obronionych strzałów wśród bramkarzy. Zostanie również poruszona kwestia gry nogami bramkarzy oraz ich skuteczności. Jest to aspekt, na który coraz częściej zwracają uwagę trenerzy w obecnych czasach. 

## Analiza skuteczności bronienia własnej bramki

W tym podrozdziale zostanie przedstawiona analiza skuteczności bramkarzy w bronieniu dostępu do własnej bramki. Początkowo, został wygenerowany wykres przedstawiający histogram czystych kont zawodników (sytuacja gry bramkarz nie straci ani jednej bramki w meczu), czyli najważniejszej statystyki defensywnej jeśli chodzi o bramkarzy.

```{r, include=FALSE, echo=FALSE}
goalkeepers <- data%>%filter(Position=='Bramkarz')
goalkeepers <- goalkeepers[,colSums(is.na(goalkeepers))<nrow(goalkeepers)]
```

```{r ,echo = FALSE}
histogram(~Clean.sheets, data=goalkeepers, col=viridis(10)[4], breaks = 5, ylab = 'Liczba piłkarzy',
          xlab = 'Liczba czystych kont', main='Histogram czystych kont bramkarzy', type = 'count')
```

Na powyższym wykresie można zauważyć, że najliczniejsza liczba bramkarzy zachowała czyste konto maksymalnie pięć razy w ciągu sezonu. Może to być skutkiem tego, że jest nieznaczna liczba bramkarzy, którzy stosunkowo rzadko występowali na boisku. Widzimy również, że dosłownie kilku bramkarzy zachowało czyste konto od 10 do 20 razy. Prawdopodobnie, są to zawodnicy najlepszych drużyn w lidze, które stosunkowo rzadko przegrywają, co wiąże się z małą liczbą traconych przez nich bramek. Kolejno, zostanie przeanalizowana zależność pomiędzy liczbą straconych bramek, a obronionymi strzałami.

```{r, echo=FALSE}
ggplot(goalkeepers) +
  geom_point(aes(Saves, Goals.conceded), colour=viridis(10)[3]) +
  geom_smooth(aes(Saves, Goals.conceded),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  theme_bw() +
  labs(title = "Stracone bramki a obronione strzały", x='Obronione strzały', y='Stracone bramki')

```
Powyższy wykres dostarcza ciekawych wniosków. Naturalnie moglibyśmy pomyśleć, że im większa liczba strzałów, tym mniej straconych bramek przez bramkarza. Nie jest to jednak prawdą, ponieważ może to oznaczać że na bramkę zawodnika pada zdecydowanie więcej strzałów, z którymi musi on sobie radzić, co powoduje większe prawdopodobieństwo utraty bramki. Inną ważną kwestią do zanotowania jest fakt, że bramkarze którzy obronili małą liczbę strzałów, prawdopodobnie wystąpili w mniejszej ilości spotkań. To powoduje, że liczba utraconych przez nich bramek może być niższa. Z tego powodu została preprowadzona analiza liczby straconych bramek na mecz oraz obronionych strzałów na mecz w podziale na liczbę czystych kont. W tym celu zostanie utworzona nowa zmienna kategoryzująca bazująca na statystyce czystych kont.

```{r, echo=FALSE}
goalkeepers <- goalkeepers %>% mutate(Goals_conceded_per_match = Goals.conceded/Appearances,
                       Clean_sheets_category=ifelse(Clean.sheets>=5, ifelse(Clean.sheets>11, 'Więcej niż 11', 'Od 5 do 11'), 'Mniej niż 5'),
                       Saves_per_match=Saves/Appearances)

xyplot(Goals_conceded_per_match ~ Saves_per_match | Clean_sheets_category, data=goalkeepers,
       layout=c(3, 1), aspect=2, xlab = 'Obronione strzały na mecz', ylab = 'Stracone gole na mecz', 
       main=list(label='Zależność straconych goli od obronionych strzałów w podziale na ilość czystych kont',
                 cex=0.9),
       panel=function(x, y) {
	     panel.lmline(x, y)
       panel.xyplot(x, y, col=viridis(10)[4], pch=19)
       })

```

Powyższe wykresy dostarczają bardzo ciekawych wniosków. Mianowicie, bramkarze którzy zachowali czyste konto więcej niż 11 razy wcale nie musieli radzić sobie ze znacznie mniejszą ilością strzałów na mecz. W ich kategorii, widać pozytywną korelację pomiędzy liczbą strzałów na mecz a liczbą straconych goli na mecz. Podobna sytuacja występuje u bramkarzy, którzy zachowali czyste konto mniej niż 5 razy. W tej kategorii, zawodnicy cieszyli się największa niechlubną statystyką liczby straconych bramek na mecz. Dwóch bramkarzy traciło średnio aż 3 bramki na mecz. W kategorii pośredniej, gdzie bramkarzy zachowywali od 5 do 11 czystych kont w ciągu sezonu nie widać korelacji pomiędzy liczbą obronionych strzałów na mecz, a straconymi bramkami na mecz. W ostatniej części tego podrozdziału zostanie wygenerowany wykres, przedstawiający bramkarzy z największym procentem obronionych strzałów. Do analizy zostali włączeni jedynie bramkarze, którzy wystąpili w przynajmniej 10 meczach.

```{r, echo=FALSE, fig.height=6.5, out.width="550px"}
temp <- goalkeepers%>%
        filter(Appearances>10)%>%
        mutate(Accuracy = Saves/(Saves+Goals.conceded))%>%
        top_n(8, Accuracy)

ggplot(temp)+
  geom_text(aes(Saves_per_match, Accuracy, label=Name, colour=Clean_sheets_category), size=6) +
  theme_bw() +
  labs(title = "Bramkarze z najwiekszym procentem obronionych strzałów", x='Obronione strzały na mecz', y='Skuteczność obrony strzałów') +
  scale_color_viridis(name='Czyste konta', discrete=TRUE, begin=0.3, end=0.8) +
  scale_x_continuous(limits = c(1.5, 4.5))+
  theme(legend.position = "bottom")

```

Jak widać na powyższym wykresie, zawodnikiem który znacznie wyróżniał się od swoich konkurentów w tym aspekcie gry był Hugo Lloris. Mógł się on pochwalić największą skutecznością obrony strzałów, przy największej ilości oddanych strzałów na jego bramkę wśród analizowanych zawodników. Co ciekawe, zachował on jedynie od 5 do 11 czystch kont w ciągu sezonu. Więcej czystych kont zachowali tacy bramkarze jak David de Gea, Alisson, Ederson czy Nick Pope.

## Gra nogami bramkarzy

Tak jak już zostało wspomniane na wstępie do tego rozdziału, element gry nogami wśród bramkarzy staje się coraz istotniejszy we współczesnym futbolu. Poniższy podrozdział ma na celu przybliżenie tego aspektu gry wśród bramkarzy ligi angielskiej. W pierwszej kolejności został przedstawiony wykres, ukazujący zależnośc pomiędzy liczbą podań bramkarza a ilością błędów prowadzących do straty bramki oraz asyst.

```{r, echo=FALSE, warning=FALSE}

ggplot(goalkeepers)+
  geom_point(aes(x=as.numeric(Passes), y=Errors.leading.to.goal, colour=factor(Assists)), size=8) +
  geom_smooth(aes(as.numeric(Passes), Errors.leading.to.goal),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  scale_color_viridis(name='Liczba asyst', discrete=TRUE, begin=0.3, end=0.8) +
  labs(x='Liczba podań', y='Błędy prowadzace do straty bramki', title='Liczba podań a błędy prowadzące do straty bramki') +
  theme_bw()
```

Na podstawie powyższego wykresu możemy zauważyć, że wraz ze wzrostem liczby podań bramkarza wzrastała liczba błędów, prowadzących do straty bramki. Wydaje się to dosyć naturalne, bramkarzom którzy podejmują większe ryzyko i biorą udział w rozgrywaniu piłki, mogą przydarzyć się błędy, prowadzące do utraty bramki. Na wykresie możemy zauważyć, że tylko dwóch bramkarzy zanotowało asystę w ciągu sezonu. Byli to bramkarze, którzy wykonali dość dużą liczbę podań. Widzimy również, że był bramkarz, który wykonał prawie 1000 podań w ciągu sezonu i nie popełnił ani jednego błędu prowadzącego do utraty bramki. Na drugim końcu znajduje się bramkarz, który również wykonał prawie 1000 podań, ale przytrafiło mu się aż pięć takich błędów. Niektórzy trenerzy wymagają od swojej drużyny szybkiego przerzucania ciężaru gry na połowę przeciwnika. Do tak obranej taktyki, może przydać się bramkarz, który potrafi celnie wykonać długie podanie. W tym celu został sporządzony poniższy wykres, który przedstawia liczbę długich podań na mecz w podziale na zawodników. Do analizy zostali włączeni bramkarze, którzy rozegrali przynajmniej 10 meczów.

```{r, echo=FALSE, warning=FALSE}

temp <- goalkeepers%>%
        filter(Appearances>10)%>%
        mutate(balls.per.match = Accurate.long.balls/Appearances)

ggplot(temp)+
  geom_col(aes(reorder(Name, balls.per.match), balls.per.match), fill=viridis(10)[5])+
  theme_minimal()+
  labs(x='Bramkarz', y='Liczba dokładnych długich podań na mecz', title='Liczba dokładnych długich podań na mecz wśród bramkarzy')+
  theme(axis.text.x = element_text(hjust=1, angle=45), axis.line.x = element_blank())
```

Widzimy na powyższym wykresie że trzech bramkarzy ma ponad 8 celnych długich podań na mecz. Możemy się spodziewać, że są to bramkarze drużyn, które lubią grać z kontrataku i szybko przenosić piłkę na połowę rywali. Czterech bramkarzy z najniższą liczbą długich podań na mecz, fani piłki nożnej mogą kojarzyć z drużyn grających krótkimi podaniami i wyprowadzającymi piłkę spod własnej bramki. Na koniec analizy bramkarzy zostaną przedstawione dwa wykresy radarowe dla wybranych bramkarzy.
```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}

temp <- goalkeepers %>%
  filter(Appearances>=10) %>%
  mutate(balls.per.match = Accurate.long.balls/Appearances,
         throw_per_match = Throw.outs/Appearances,
         high_claim_per_match = High.Claims/Appearances)

normalize <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}

temp['Goals_conceded_per_match'] <- normalize(temp['Goals_conceded_per_match'])
temp['balls.per.match'] <- normalize(temp['balls.per.match'])
temp['Saves_per_match'] <- normalize(temp['Saves_per_match'])
temp['Passes.per.match'] <- normalize(temp['Passes.per.match'])
temp['Clean.sheets'] <- normalize(temp['Clean.sheets'])
temp['high_claim_per_match'] <- normalize(temp['high_claim_per_match'])

create_data_keepers <- function(x){
temp2 <- temp%>%
  filter(Name%in%x) %>%
  select(Saves_per_match, Goals_conceded_per_match, balls.per.match, Passes.per.match, 
         Clean.sheets, high_claim_per_match,Name)
rownames(temp2) <- temp2$Name 
temp2 <- temp2[, -7]
temp2 <- rbind(rep(1, 6), rep(0,6), temp2)
colnames(temp2) <- c("Obronione strzały na mecz", "Stracone bramki na mecz", "Celne długie podania na mecz", "Podania na mecz",
                               "Czyste konta", "Wysokie piłki na mecz")
return(temp2)

}

alisson_ederson <- create_data_keepers(c("Alisson", "Ederson", "David de Gea"))
scale_colours=c(viridis(3)[3], viridis(3)[2], magma(3)[2])
radarchart(alisson_ederson, pcol=scale_colours, plwd=3, vlcex=0.7)
legend(x=1, 
       y=1.35, 
       legend = rownames(alisson_ederson[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex = 0.7)
```
Wykresy radarowe są bardzo użyteczną formą wizualizacji statysty zawodników i porównywanie ich. Powyższe wykresy dostarczają bardzo wartościowych informacji na temat konkretnych zawodników i ich skuteczności w grze. W pierwszej kolejności wszystkie powyżej przedstawione statystyki zostały znormalizowane przy wykorzystaniu nastepującej funkcji: y(x) = (x - min(**X**)) / (max(**X**) - min(**X**)), gdzie x należy do wektora **X**. Na podstawie pierwszego wykresu, możemy zauważyć że Ederson był najlepszym bramkarzem pod względem liczby czystych kont w porównaniu do dwóch innych bramkarzy, Alissona oraz Davida de Gei. Natomiast jeśli chodzi o liczbę podań na mecz, najlepszy w tej kategorii w tej trójce był Alisson. David de Gea przewodzi w kategorii obronionych strzałów na mecz. 

```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}
fabian <- create_data_keepers(c("Lukasz Fabianski", "Hugo Lloris", "Ben Foster"))
radarchart(fabian, pcol=scale_colours, plwd=3, vlcex = 0.7)
legend(x=1, 
       y=1.35, 
       legend = rownames(fabian[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex=0.7)
```

Jeśli chodzi o drugi wykres, widać zdecydowaną przewagę Hugo Llorisa w kategorii liczby obronionych strzałów na mecz nad dwójką innych bramkarzy, Łukasza Fabiańskiego oraz Bena Fostera. Przewodzi on również pod względem liczby straconych bramek na mecz, ponieważ w tej statystyce im mniejsza liczba tym pozytywniej świadczy to o zawodniku.

# Analiza statystyk obrońców

W tym rozdziale zostanie przeprowadzona analiza statystyk piłkarzy, występujących na pozycji obrońcy. Najważniejszą rolą obrońcy jest uniemożliwienie stworzenia dogodnej sytuacji do zdobycia bramki przez przeciwników. Dlatego, ten rozdział w głównej mierze będzie poświęcony analizie statystyk, mówiących o skuteczności bronienia dostępu do własnej bramki, czy agresywności. W obecnych czasach, w których coraz częsciej jest promowany ofensywny futbol, nawet obrońcy są odpowiedzialni za tworzenie okazji do zdobycia bramki. Z tego powodu, zostanie przeprowadzona również krótka analiza skuteczności obrońców pod bramką rywala.

## Analiza defensywnych statystyk obrońców

Poniższy podrozdział będzie zawierał analizę defensywnych statystyk obrońców, takich jak liczba czystych kont, liczba pojedynków oraz ich skuteczność, czy liczba przechwytów. W bazie znajduje się 161 obrońców. Poniżej zaprezentowano histogram procentu liczby czystych kont w sezonie wśród obrońców.

```{r, include=F, echo=F}
defenders <- data%>%filter(Position=='Obrońca')
defenders <- defenders[,colSums(is.na(defenders))<nrow(defenders)]
```
```{r, echo=F}
ggplot(defenders, aes(Clean.sheets/Appearances))+
  geom_histogram(breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6),
                 fill=viridis(10)[5])+
  theme_minimal()+
  stat_bin(breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6), geom="text",aes(label=..count..),
           vjust=-1.5)+
  labs(title="Histogram procentu czystych kont na mecz wśród obrońców", 
       x="Procent czystych kont na mecz",
       y="Ilość zawodników") +
  scale_x_continuous(breaks=c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6),
                     labels=c("0%", "10%", "20%", "30%", "40%", "50%", "60%"))+
  scale_y_continuous(limits=c(0, 70))
```

Powyższy wykres dostarcza informacji, że wartość odsetka czystych kont na mecz w sezonie najczęściej wynosiła z przedziału 10% - 20%. Aż 55 zawodników zaliczało się do tego przedziału. Tylko jeden zawodnik co drugi mecz ukończył z czystym kontem. Następnie została zwizualizowana zależność pomiędzy liczbą pojedynków na mecz a liczbą straconych bramek na mecz w podziale na odsetek czystych kont na mecz. Poniższa analiza uwzględnia obrońców, którzy rozegrali przynajmniej 10 spotkań w ciągu sezonu.

```{r, echo=FALSE, out.width="450px"}
ggplot(defenders%>%filter(Appearances>=10))+
  geom_point(aes(x=Tackles/Appearances, y=Goals.conceded/Appearances, 
                 colour=Clean.sheets/Appearances), size=4)+
  scale_color_gradientn(name="Odsetek czystych kont na mecz", colours=c(viridis(10)[10], viridis(10)[1]))+
  geom_smooth(aes(x=Tackles/Appearances, y=Goals.conceded/Appearances),
              method = "lm", se = FALSE)+
  theme_minimal()+
  labs(title="Liczba wślizgów na mecz a liczba straconych bramek na mecz \nw podziale na odsetek czystych kont na mecz", x="Liczba wślizgów na mecz", y="Liczba straconych bramek na mecz")+
  theme(legend.position="bottom") 
```

Na podstawie powyższego wykresu, można wysnuć wniosek że nie ma zależności pomiędzy liczbą wślizgów na mecz a liczbą straconych bramek na mecz. Widać natomiast pewną ujemną zależność pomiędzy liczbą straconych bramek na mecz a odsetkiem czystych kont na mecz, co wydaje się być oczywistą zależnością. Niżej osadzone punkty mają raczej ciemniejszą barwę niż te powyżej, so sugeruje że wraz z mniejszą liczbą straconych bramek na mecz odsetek czystych kont na mecz wzrasta. Następnie przeanalizowano wpływ odsetka wygranych pojedynków na liczbę zablokowanych strzałów na mecz. 

```{r, echo=F, out.width="500px"}
defenders$clean_sheets <- ifelse(defenders$Clean.sheets<3, "Mniej niż 3 czyste konta", 
                                 ifelse(defenders$Clean.sheets<6, "Między 3 a 6 czystych kont",
                                        ifelse(defenders$Clean.sheets<10, "Między 6 a 10 czystych kont",
                                               "Więcej niż 10 czystych kont")))
defenders$Duel.accuracy <- defenders$Duels.won/(defenders$Duels.won+defenders$Duels.lost)

ggplot(defenders%>%filter(Appearances>=5 & !is.na(Clean.sheets)), 
       aes(x=Duel.accuracy, y=Blocked.shots/Appearances))+
  geom_point(aes(colour=Goals.conceded/Appearances), size=3)+
  scale_color_gradientn(name="Liczba straconych bramek na mecz", colours=c(viridis(10)[10], viridis(10)[1]))+
  facet_wrap(~clean_sheets, ncol=2)+
  geom_smooth(aes(x=Duel.accuracy, y=Blocked.shots/Appearances),
              method = "lm", se=FALSE)+
  theme_minimal()+
  labs(title="Zablokowone strzałe na mecz a skuteczność pojedynków oraz liczbę \nstraconych bramek w podziale na liczbę czystych kont", y="Zablokowane strzały na mecz", 
       x="Odsetek wygranych pojedynków")+
  theme(legend.position="bottom")
```

Powyższy wykres dostarcza wiele różnych wniosków na temat gry obronnej zawodników. W pierwszej kolejności, w trzech z czterech kategorii widać ujemną zależność pomiędzy skutecznością pojedynków a liczbą zablokowanych strzałów na mecz. Natomiast obrońcy, którzy zachowali czyste konta mniej niż 3 razy wyłamują się z tego schematu. W ich przypadku tej zależności nie widać. Nie widać zależności pomiędzy liczbą straconych bramek na mecz a liczbą zablokowanych strzałów na mecz. Tak samo jak pomiędzy liczbą straconych bramek a skutecznością pojedynków. Następnie została utworzona nowa zmienna, określająca ilość udanych akcji defensywnych na mecz (podzielona suma wślizgów, zablokowanych strzałów, przechwytów i wybić piłki przez liczbę rozegranych meczów). Poniżej przedstawiono wykres wartości tej zmiennej wśród 10 najlepszych obrońców, którzy rozegrali przynajmniej 10 meczy.

```{r, echo=F, out.width="450px"}

temp <- defenders%>%
  filter(Appearances>=10 & !is.na(Clean.sheets))%>%
  mutate(Succesful_actions = (Tackles+Blocked.shots+Interceptions+Clearances+Recoveries)/Appearances)%>%
  top_n(20, Succesful_actions)
  
ggplot(temp)+
  geom_col(aes(reorder(Name, Succesful_actions), Succesful_actions, fill=Goals.conceded/Appearances))+
  theme_minimal()+
  coord_cartesian(ylim = c(10, 15))+
  labs(x='Obrońca', y='Liczba skutecznych akcji defensywnych na mecz', title='Liczba skutecznych akcji defensywnych na mecz wśród obrońców')+
  theme(axis.text.x = element_text(hjust=1, angle=45), axis.line.x = element_blank())+
  scale_fill_viridis("Liczba straconych bramek na mecz", begin=0.5, end=0)+
  theme(legend.position = "bottom", axis.title.y = element_text(size=7))
```

Na powyższym wykresie widzimy, że najwyższą liczbę skutecznych akcji defensywnych na mecz miał Ricardo Pereira. Wartość ta wynosiła prawie 15. Miał on również około 1 bramkę straconą na mecz, co nie jest najgorszym wynikiem. Dla przykładu drugi w naszym zestawieniu jest Jan Bednarek, który zaliczał nieco ponad 14.5 skutecznych akcji na mecz, natomiast miał aż 1.5 bramek straconych na mecz. W następnej części analizy statystyk obrońców będzie skupiona uwaga na ofensywnych aspektach ich gry. 

## Analiza skuteczności obrońców w ofensywie

Rola obrońców w meczu piłki nożnej zmieniła się drastycznie na przestrzeni ostatniego stulecia. W początkowej fazie rozwoju piłki nożnej, byli oni jedynie odpowiedzialni za bronienie dostępu do własnej bramki. Natomiast w nowoczesnym futbolu obrońcy są coraz częściej wykorzystywani w grze ofensywnej i kreowaniu sytuacji pod bramką rywala. Poniżej przedstawiono histogram liczby strzelonych bramek wśród obrońców.

```{r, echo=F}
ggplot(defenders, aes(Goals))+
  geom_histogram(binwidth = 1,
                 fill=viridis(10)[5])+
  theme_minimal()+
  stat_bin(geom="text",binwidth=1, aes(label=..count..),
           vjust=-1.5)+
  labs(title="Histogram liczby bramek wśród obrońców", 
       x="Liczba bramek",
       y="Ilość zawodników") +
  scale_x_continuous(breaks=c(0, 1, 2, 3, 4, 5),
                     labels=c(0, 1, 2, 3, 4, 5))+
  scale_y_continuous(limits=c(0, 105))
```

Na podstawie powyższego wykresu widzimy, że zdecydowana część obrońców nie zdobyła ani jednej bramki w ciągu sezonu. Tylko 11 obrońców zdobyło więcej niż 2 bramki w przeciągu sezonu. Następnie zostanie przedstawiony wykres ukazujący zależność pomiędzy liczbą podań a liczbą wykreowanych sytuacji i liczbą asyst na mecz wśród obrońców. Dalsza analiza została przeprowadzona dla obrońców, którzy rozegrali przynajmniej 15 meczy w przeciągu całego sezonu.

```{r, echo=F}
temp <- defenders%>%filter

ggplot(defenders%>%filter(Appearances>=15), aes(Passes/Appearances, Big.chances.created/Appearances))+
  geom_point(aes(colour=Assists/Appearances), size=8) +
  geom_smooth(aes(Passes/Appearances, Big.chances.created/Appearances),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  labs(x='Liczba podań na mecz', y='Liczba wykreowanych sytuacji na mecz', title='Liczba podań a wykreowane sytuacje') +
  theme_bw()+
  scale_color_gradientn(name="Liczba asyst na mecz", colours=c(viridis(10)[10], viridis(10)[1]))
```

Na powyższym wykresie widać pewną dodatnią zależność pomiędzy liczbą podań na mecz a liczbą wykreowanych sytuacji na mecz. Widać też, pozytywną zależność pomiędzy liczbą wykreowanych sytuacji a liczbą asyst na mecz, ponieważ im punkt znajduje się wyżej na osi y, tym ma średnio ciemniejszą barwę. Najskuteczniejsci obrońcy w grze ofensywnej tworzyli średnio około 4 okazje na mecz oraz zaliczali 0.3 asysty na mecz, co jest bardzo dobrym wynikiem jak na obrońców. Następnie zostaną przedstawione dwa wykres radarowy dla wybranych obrońców. Schemat wyliczenia przedstawionych statystyk został przeprowadzony analogicznie do statystyk przy wykresach radarowych bramkarzy.

```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}

temp <- defenders %>%
  filter(Appearances>=10) %>%
  mutate(Goals_conceded_per_match = Goals.conceded/Appearances,
         Passes.per.match = Passes/Appearances,
         tackles_per_match = Tackles/Appearances,
         chances = Big.chances.created/Appearances,
         inter = Interceptions/Appearances,
         cross = Crosses/Appearances)

normalize <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}

temp['Goals_conceded_per_match'] <- normalize(temp['Goals_conceded_per_match'])
temp['tackles_per_match'] <- normalize(temp['tackles_per_match'])
temp['chances'] <- normalize(temp['chances'])
temp['Duel.accuracy'] <- normalize(temp['Duel.accuracy'])
temp['inter'] <- normalize(temp['inter'])
temp['cross'] <- normalize(temp['cross'])

create_data_def <- function(x){
temp2 <- temp%>%
  filter(Name%in%x) %>%
  select(tackles_per_match, Goals_conceded_per_match, chances, Duel.accuracy, 
         inter, cross,Name)
rownames(temp2) <- temp2$Name 
temp2 <- temp2[, -7]
temp2 <- rbind(rep(1, 6), rep(0,6), temp2)
colnames(temp2) <- c("Wślizgi na mecz", "Stracone bramki na mecz", "Stworzone okazje na mecz", "Skuteczność pojedynków",
                               "Przechwyty na mecz", "Crossy na mecz")
return(temp2)

}

vvd <- create_data_def(c("Virgil van Dijk", "Jan Bednarek", "Willy Boly"))
scale_colours=c(viridis(3)[3], viridis(3)[2], magma(3)[2])
radarchart(vvd, pcol=scale_colours, plwd=3, vlcex=0.7)
legend(x=1, 
       y=1.35, 
       legend = rownames(vvd[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex = 0.7)
```

Powyższy wykres przedstawia porównanie trzech wybranych obrońców, którzy grają na pozycji stopera. Widzimy, że przebieg wykresów dla każdego z nich jest w miarę podobny. Najwyższą skutecznością pojedynków mógł pochwalić się Virgil Van Dijk. Jeśli chodzi o liczbę przechwytów na mecz, najlepszy wśród tej wybranej trójki obrońców był Jan Bednarek. Natomiast największą liczbę wślizgów na mecz wykonał Willy Boly. Wysoka wartość tej statystyki nie musi być jednak pozytywna. Może ona oznaczać, że obrońca często popełniał błędy w ustawieniu i musiał ratować sytuację wślizgiem. Następnie został przedstawiony wykres powyższych statystyk dla bardziej ofensywnie usposobionych zawodników, czyli bocznych obrońców.

```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}
taa <- create_data_def(c("Trent Alexander-Arnold", "Ricardo Pereira", "Lucas Digne"))
scale_colours=c(viridis(3)[3], viridis(3)[2], magma(3)[2])
radarchart(taa, pcol=scale_colours, plwd=3, vlcex=0.7)
legend(x=0.7, 
       y=1.35, 
       legend = rownames(taa[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex = 0.7)
```

Powyższy wykres dostarcza bardzo ciekawych wniosków. Zawodnicy przedstawieni na tym wykresie mają bardzo odmienny przebieg statystyk, pomimo względnie podobnej zajmowanej pozycji na boisku. Przykładowo, Trent Alexander-Arnold deklasuje swoich konkurentów pod względem liczby stworzonych okazji na mecz. Natomiast zajmuje ostatnie miejsce pod względem skuteczności wygranych pojedynków, czy liczby wślizgów na mecz. Ricardo Pereira przewodzi w statystyce liczby wślizgów ne mecz oraz przechwytów ne mecz, lecz przegrywa pod względem liczby stworzonych okazji. 

# Analiza statystyk pomocników

Niniejszy rozdział będzie zawierał analizę wizualną statystyk pomocników, występujących w lidze angielskiej w sezonie 2019/2020. Piłkarze grający na tej pozycji powinni być zdecydowanie bardziej wszechstronni niż zawodnicy na innych pozycjach. Zadaniem pomocników jest przerywanie akcji rywali w środku pola, ale również kreowanie sytuacji oraz zdobywanie bramek. W analizowanym zbiorze danych znajduje się 179 pomocników.

## Analiza statystyk defensywnych

W pierwszej kolejności analiza będzie skupiona na statystykach defensywnych pomocników. Tak jak było wspominane we wstępie do rozdziału, trenerzy poszukujący zawodników do swojej drużyny mogą zwracać dużą uwagę na ten aspekt gry. Poniżej przedstawiono wykres, ukazujący zależność pomiędzy liczbą przechwytów na mecz a liczbą wybić piłki na mecz oraz liczby wślizgów na mecz.

```{r, echo=F}
midfielders <- data %>% filter(Position=='Pomocnik')
ggplot(midfielders, aes(Clearances/Appearances, Interceptions/Appearances))+
  geom_point(aes(colour=Tackles/Appearances), size=8) +
  geom_smooth(aes(Clearances/Appearances, Interceptions/Appearances),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  labs(x='Liczba wybić piłki na mecz', y='Liczba przechwytów na mecz', title='Liczba wybić piłki a liczba przechwytów na mecz') +
  theme_bw()+
  scale_color_gradientn(name="Liczba wślizgów na mecz", colours=c(viridis(10)[10], viridis(10)[1]))+
  theme(legend.position = 'bottom')
```

Na powyższym wykresie widać silną pozytywną zależność pomiędzy liczbą przechwytów a liczbą wybić piłki na mecz. Można też zauważyć dodatnią zależność pomiędzy liczbą wślizgów a wymienionymi zmiennymi. Oznacza to, że można się spodziewać dużej liczby przechwytów na mecz u zawodnika, który wykonuje relatywnie dużo wślizgów na mecz oraz często wybija piłkę. Na poniższym wykresie przedstawiono dziesięciu najlepszych pomocników pod względem liczby przechwytów na mecz, którzy rozegrali przynajmniej 10 meczy.

```{r, echo=F, fig.height=6.5, out.width="550px"}

temp <- midfielders%>%
  filter(Appearances>=10)%>%
  mutate(Wslizg = ifelse(Tackles/Appearances>=3, 'Więcej bądź równe 3', 'Mniej niż 3' )) %>%
  top_n(10, Interceptions/Appearances)
  
ggplot(temp)+
  geom_text(aes(Clearances/Appearances, Interceptions/Appearances, label=Name, colour=Wslizg), size=5) +
  theme_bw() +
  labs(title = "Pomocnicy z najwyższą liczbą przechwytów na mecz", x='Liczba wybić piłki na mecz', y='Liczba przechwytów sytuacji na mecz') +
  scale_color_viridis(name='Wślizgi na mecz', discrete=TRUE, begin=0.3, end=0.8)+
  theme(legend.position = 'bottom')+
  scale_x_continuous(limits = c(0.2, 4.5))
```

Wilfred Ndidi był pomocnikiem, który zaliczył najwięcej przechwytów na mecz (średnio około 2.5 raza), wykonując przy tym średnio przynajmniej trzy wślizgi na mecz. Ciekawym przypadkiem jest zawodnik Romain Saiss, który średnio ponad cztery razy w ciągu meczy wybijał piłkę, natomiast przechwytywał piłkę średnio mniej niż 1.7 razy na mecz. Ważnym aspektem przy wyborze odpowiedniego pomocnika do swojej drużyny jest również umiejętność gry w powietrzu. Skutecznośc w tym elemencie może pozwalać drużynie zbierać dużo "drugich piłek" i rozpoczynać ataki na bramkę przeciwnika. Poniższy wykres przedstawia 10 najlepszych pomocników w tym elemencie.

```{r, echo=FALSE, warning=FALSE, out.width='650px', fig.width=7}

temp <- midfielders%>%
        filter(Appearances>10)%>%
        mutate(accuracy = Aerial.battles.won/(Aerial.battles.won+Aerial.battles.lost))%>%
        top_n(20, accuracy)

ggplot(aes(reorder(Name, accuracy), accuracy), data=temp)+
  geom_col(fill=viridis(10)[5])+
  geom_text(aes(label=paste0(round(100*accuracy, 0), " %")), hjust=-0.1, size=3.5)+
  theme_minimal()+
  coord_flip() +
  labs(x='Pomocnik', y='Skuteczność wygranych pojedynków powietrznych', title='Najlepsi pomocnicy w grze powietrznej')+
  theme(axis.text.x = element_text(hjust=0.5, angle=25))+
  scale_y_continuous(labels=percent)
```

Najlepsi pomocnicy pod względem gry w powietrzu mieli skuteczność powyżej 70 % w tym elemencie gry. Paul Pogba miał najwyższy procent skuteczności wygranych pojedynków powietrznych. Wyniósł on około 72 %. Do najlepszej dwudziestki pomocników w aspekcie gry powietrznej, załapali się zawodnicy wygrywający około 59 % takich pojedynków.

## Analiza statystyk ofensywnych

W tym podrozdziale zostaną poddane analizie statystyki ofensywne zawodników, występujących na pozycji pomocnika. W obecnym futbolu pomocnicy często strzelają bramki czy zaliczają asysty w podobnych częstotliwościach jak napastnicy. Początkowo, został wygenerowany wykres przedstawiający zależnośc pomiędzy liczbą zdobytych bramek a liczbą asyst oraz liczbą akcji defensywnych wśród pomocników, któzy wystąpili w przynajmniej 10 meczach.

```{r, echo=FALSE, warning=FALSE}
temp <- midfielders%>%
  mutate(actions = Tackles+Blocked.shots+Interceptions+Clearances+Headed.Clearance+Recoveries+Duels.won+Aerial.battles.won)%>%
  filter((Appearances>=10) & (Assists!=0 | Goals!=0))
  
ggplot(temp, aes(Assists/Appearances, Goals/Appearances))+
  geom_point(aes(colour=actions/Appearances), size=8) +
  geom_smooth(aes(Assists/Appearances, Goals/Appearances),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  labs(x='Liczba asyst na mecz', y='Liczba bramek na mecz', title='Zdobyte bramki a asysty oraz akcje defensywne') +
  theme_bw()+
  scale_color_gradientn(name="Liczba akcji defensywnych na mecz", colours=c(viridis(10)[10], viridis(10)[1]))+
  theme(legend.position = 'bottom')
```

Zarówno linia regresji jak i ułożenie punktów świadczy o pozytywnej zależności między liczbą asyst a liczbą bramek na mecz. Barwa punktów określa aktywność pomocników w akcjach defensywnych. Na podstawie powyższego wykresu ciężko zauważyć jakąś zależność pomiędzy liczbą akcji defensywnych a skutecznością gry w ataku. Z tego względu został przedstawiony poniższy wykres, ukazujący zależność między liczbą akcji defensywnych na mecz a liczbą zdobytych bramek oraz asyst na mecz.

```{r, echo=FALSE, warning=FALSE}
ggplot(temp, aes(actions/Appearances, (Goals+Assists)/Appearances))+
  geom_point(size=8, colour=viridis(10)[6]) +
  geom_smooth(aes(actions/Appearances, (Goals+Assists)/Appearances),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  labs(x='Liczba akcji defensywnych na mecz', y='Liczba asyst oraz bramek na mecz', title='Skuteczność gry w ataku a aktywność defensywna') +
  theme_bw()
```

Widać słabą negatywną zależność pomiędzy aktywnością w defensywie a skutecznością gry w ataku. Na podstawie tego wykresu, możemy wysnuć wniosek, że piłkarz który rzadziej udziela się w defensywie średnio będzie częściej strzelał bramki lub asystował. Siła zależności pomiędzy tymi dwoma zmiennymi jest jednak nieduża. Kolejno, został utworzony wykres, ukazujący zależność pomiędzy liczbą podań na mecz a liczbą asyst oraz stworzonymi okazjami na mecz.

```{r, echo=FALSE, warning=FALSE}
ggplot(midfielders, aes(Passes/Appearances, Big.chances.created/Appearances))+
  geom_point(aes(colour=Assists/Appearances), size=8) +
  geom_smooth(aes(Passes/Appearances, Big.chances.created/Appearances),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  labs(x='Liczba podań na mecz', y='Liczba wykreowanych sytuacji na mecz', title='Liczba podań a wykreowane sytuacje') +
  theme_bw()+
  scale_color_gradientn(name="Liczba asyst na mecz", colours=c(viridis(10)[10], viridis(10)[1]))+
  theme(legend.position = 'bottom')
```

Na powyższym wykresie można zauważyć zależnośc pomiędzy liczbą wykreowanych sytuacji oraz liczbą podań na mecz. Co ciekawe, było dwóch zawodników, którzy wykonali ponad 60 podań na mecz i nie stworzyli ani jednej sytuacji w przeciągu całego sezonu. Widać również pewną zależność pomiędzy liczbą wykreowanych sytuacji a liczbą asyst na mecz. Wydaje się to dosyć naturalne. Wśród pomocników jeden z nich wyróżniał się zarówno pod względem liczby stworzonych sytuacji, jak i liczbą asyst na mecz. Zaliczał około 0.5 asysty na mecz, co oznacza że w co drugim występie zaliczał asystę. Jest to bardzo dobry wynik. Następny wykres przedstawia 15 najlepszych pomocników pod względem liczby zdobytych bramek oraz asyst w przeciągu sezonu.

```{r, echo=F, warning=F, out.width='650px'}
temp <- midfielders%>%
  top_n(20, Goals+Assists)%>%
  select(Name, Goals, Assists) %>%
  arrange(Goals+Assists) %>%
  mutate(Name = factor(Name, levels = unique(Name)))

temp <- melt(temp, id.vars="Name")

ggplot(temp, aes(Name, value, group=variable))+
  geom_col(aes(fill=variable)) +
  scale_fill_viridis_d("Statystyka", labels=c("Gole", "Asysty"),begin=0.5, end=1) +
  geom_text(aes(label = value), position = position_stack(vjust = 0.5)) +
  theme_minimal()+
  labs(x='Pomocnik', y='Liczba bramek lub asyst', title='Najlepsi pomocnicy w akcjach ofensywnych')+
  theme(axis.text.x = element_text(hjust=1, angle=45), axis.line.x = element_blank())+
  theme(legend.position = 'bottom')
```

Kevin de Bruyne był zawodnikiem, który był zdecydowanym liderem klasyfikacji kanadyjskiej (bramki + asysty) wśród pomocników. Zdobył on aż 13 bramek oraz zaliczył 20 asyst. Przykładowo, drugi w kolejności, David Silva miał 6 goli oraz 10 asyst. Co ciekawe, obaj zawodnicy grali w sezonie 2019/2020 w jednym zespole. Następnie zostaną przedstawione dwa wykresy radarowe dla wybranych zawodników. 

```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}

temp <- midfielders %>%
  filter(Appearances>=10) %>%
  mutate(Goals_per_match = Goals/Appearances,
         Passes.per.match = Passes/Appearances,
         actions_per_match = (Tackles+Blocked.shots+Interceptions+Clearances+Headed.Clearance+Recoveries+Duels.won+Aerial.battles.won)/Appearances,
         chances = Big.chances.created/Appearances,
         assists = Assists/Appearances,
         accuracy = Aerial.battles.won/(Aerial.battles.won+Aerial.battles.lost))

normalize <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}

temp['Goals_per_match'] <- normalize(temp['Goals_per_match'])
temp['Passes.per.match'] <- normalize(temp['Passes.per.match'])
temp['actions_per_match'] <- normalize(temp['actions_per_match'])
temp['chances'] <- normalize(temp['chances'])
temp['assists'] <- normalize(temp['assists'])
temp['accuracy'] <- normalize(temp['accuracy'])

create_data_mid <- function(x){
temp2 <- temp%>%
  filter(Name%in%x) %>%
  select(Goals_per_match, Passes.per.match, actions_per_match, chances, 
         assists, accuracy,Name)
rownames(temp2) <- temp2$Name 
temp2 <- temp2[, -7]
temp2 <- rbind(rep(1, 6), rep(0,6), temp2)
colnames(temp2) <- c("Gole na mecz", "Podania na mecz", "Liczba akcji defensywnych", "Stworzone okazje na mecz",
                               "Asysty na mecz", "Skutecznośc w powietrzu")
return(temp2)

}

wpr <- create_data_mid(c("Wilfred Ndidi", "Paul Pogba", "Rodrigo"))
scale_colours=c(viridis(3)[3], viridis(3)[2], magma(3)[2])
radarchart(wpr, pcol=scale_colours, plwd=3, vlcex=0.7)
legend(x=1, 
       y=1.35, 
       legend = rownames(wpr[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex = 0.7)
```

Na podstawie powyższego wykresu, można wywnioskować, że do analizy zostali wybrani zawodnicy o podobnej charakterystyce. Mają bardzo zbliżone do siebie wartości we wszystkich statystykach. Paul Pogba wyróżniał się pośród pozostałych w statystyce liczby asyst na mecz oraz stworzonych okazji. Rodrigo natomiast górówał nad innymi pod względem liczby podań na mecz. Następnie, przedstawiono po raz kolejny wykres radarowy z trzema innymi wybranymi pomocnikami. 

```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}

kdc <- create_data_mid(c("Kevin De Bruyne", "Dele Alli", "Christian Pulisic"))
scale_colours=c(viridis(3)[3], viridis(3)[2], magma(3)[2])
radarchart(kdc, pcol=scale_colours, plwd=3, vlcex=0.7)
legend(x=1, 
       y=1.35, 
       legend = rownames(kdc[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex = 0.7)
```

Na pierwszy rzut oka można zauważyć inny przebieg wykresu niż poprzednim razem. Świadczy to o tym, że mamy w tym momencie do czynienia z zawodnikami o innej specyfice gry. Tym razem, zostali poddani analizie zawodnicy bardziej ofensywni. Widać to po statystykach liczby akcji defensywnych oraz skuteczności w powietrzu. Co ciekawe, w tym przypadku we wszystkich kategoriach wygrywa Kevin De Bruyne. Nic dziwnego, że ten zawodnik zdobył statuetkę dla najlepszego piłkarza w sezonie 2019/2020 w lidze angielskiej. 

# Analiza statystyk napastników

W kolejnym rozdziale zostaną poddane analizie statystyki napastnikóW, występujących w sezonie 2019/2020 w lidze angielskiej. Napastnicy od zawsze byli rozliczani ze zdobytych bramek. Umiejętność zdobywania bramek jest najistotniejszym elementem gry zawodników, występujących na tej pozycji. Wraz z rozwojem futbolu napastnicy zaczęli pełnić coraz większą rolę w rozgrywaniu akcji oraz stwarzania okazji swoim partnerom. W pierwszej kolejności zostanie wygenerowany wykres zdobytych bramek wśród napastników.

```{r, include=F, echo=F}
forwards <- data%>%filter(Position=='Napastnik')
forwards <- forwards[,colSums(is.na(forwards))<nrow(forwards)]
```
```{r, echo=F}
ggplot(forwards, aes(Goals))+
  stat_bin(breaks=c(0, 2, 5, 10, 15, 20, 25), fill=viridis(10)[5])+
  theme_minimal()+
  stat_bin(breaks=c(0, 2, 5, 10, 15, 20, 25), geom="text",aes(label=..count..),
           vjust=-1.5)+
  labs(title="Histogram zdobytych bramek wśród napastników", 
       x="Bramki",
       y="Ilość zawodników") +
  scale_x_continuous(breaks=c(0, 2, 5, 10, 15, 20, 25))+
  scale_y_continuous(limits=c(0, 50))
```

Na powyższym wykresie można zauważyć że prawie 80 napastników zdobyło mniej niż 5 bramek w ciągu całego sezonu. Aż ośmiu zawodników zdobyło równo lub więcej niż 15 goli. Jest to bardzo dobry rezultat. Następnie przeanalizujemy jaka była zależność pomiędzy liczbą oddanych strzałów a liczbą zdobytych bramek oraz liczbą wykonanych podań. Wszystkie wartości zostaną podzielone przez liczbę występów aby uzyskać średnie statystyki na jeden mecz.

```{r, echo=FALSE, warning=FALSE}
ggplot(forwards, aes(Shots/Appearances, Goals/Appearances))+
  geom_point(aes(colour=Passes/Appearances), size=8) +
  geom_smooth(aes(Shots/Appearances, Goals/Appearances),method = "lm", se = FALSE, colour=viridis(10)[2]) +
  labs(x='Liczba strzałów na mecz', y='Liczba bramek na mecz', title='Zdobyte bramki a liczba oddanych strzałów oraz wykonanych podań') +
  theme_bw()+
  scale_color_gradientn(name="Liczba podań na mecz", colours=c(viridis(10)[10], viridis(10)[1]))+
  theme(legend.position = 'bottom')
```

Tak jak się można było spodziewać, na powyższym wykresie widać pozytywną zależność pomiędzy liczbą strzałów a liczbą zdobytych bramek na mecz. Co ciekawe, widać również podobną zależność pomiędzy liczbą zdobytych goli a liczbą wykonanych podań. Oznacza to, że napastnicy którzy są aktywniejsi w rozgrywaniu akcji oraz kreowaniu sytuacji średnio częściej zdobywają bramki. Kolejno, zostanie przedstawiony wykres napastnikóW, którzy potrzebowali najmniejszej liczby strzałów w zdobyciu bramki. Tacy zawodnicy mogą być bardzo wartościowi dla drużyn, które nie tworzą wielu sytuacji w ciągu meczu. Analizie zostaną poddani napastnicy, którzy rozegrali przynajmniej 10 meczy w ciągu sezonu oraz zdobyli 5 bramek.

```{r, echo=FALSE, warning=FALSE}

temp <- forwards%>%
        filter(Appearances>=10 & Goals >=5)%>%
        mutate(accuracy = Shots/Goals) %>%
        select(Name, accuracy, Passes, Appearances) %>%
        top_n(-10, accuracy)

ggplot(temp)+
  geom_col(aes(reorder(Name, accuracy), accuracy, fill=Passes/Appearances))+
  theme_minimal()+
  labs(x='Napastnik', y='Liczba oddanych strzałów na jedną bramkę', title='Najskuteczniejsci zawodnicy')+
  theme(axis.text.x = element_text(hjust=1, angle=45), axis.line.x = element_blank())+
  scale_fill_viridis("Liczba podań na mecz", begin=0.8, end=0)
```

Widzimy, że najskuteczniesi zawodnicy potrzebowali średnio mniej niż 4 strzały aby zdobyć bramkę. Njalepsi w tym aspekcie byli Jamie Vardy oraz Mason Greenwood. Co ciekawe, wykonywali oni relatywnie mało podań na mecz w okolicy 15 - 20. Może to oznaczać, że grali oni w zespołach, które nie prowadziły gry i nie kreowały wielu sytuacji w ciągu meczu. Następnie zostanie przedstawiona zależność pomiędzy liczbą podań a liczbą wykreowanych sytuacji oraz liczbą asyst na mecz wśród 10 najlepszych napastników pod względem liczby asyst. 

```{r, echo=FALSE, warning=FALSE, out.width='650px', fig.height=8}

temp <- forwards%>%
        filter(Appearances>=10)%>%
        top_n(10, Assists)

ggplot(temp)+
  geom_text(aes(Passes/Appearances, Big.chances.created/Appearances, label=Name, colour=Assists/Appearances), size=4.5) +
  theme_bw() +
  labs(title = "Najlepsi asystenci wśród napastników", x='Liczba podań na mecz', y='Liczba wykreowanych sytuacji na mecz') +
  scale_color_viridis(name='Asysty na mecz', begin=0.8, end=0.3)+
  theme(legend.position = 'bottom')+
  scale_x_continuous(limits = c(15, 42))
```

Na pierwszy rzut oka widać pozytywną zależność pomiędzy liczbą podań na mecz a liczbą wykreowanych sytuacji na mecz. Na wykresie można zauważyć również zależność pomiędzy liczbą wykreowanych sytuacji na mecz a liczbą asyst na mecz wśród napastników. Im wyżej na wykresie znajduje się etykieta z danym nazwiskiem piłkarza tym ciemniejsza jest barwa czcionki. Następnie został utworzony wykres, przedstawiający najlepszych napastników pod względem klasyfikacji kanadyjskiej (liczba bramek + liczba asyst).

```{r, echo=F, warning=F, out.width='650px'}
temp <- forwards%>%
  top_n(20, Goals+Assists)%>%
  select(Name, Goals, Assists) %>%
  arrange(Goals+Assists) %>%
  mutate(Name = factor(Name, levels = unique(Name)))

temp <- melt(temp, id.vars="Name")

ggplot(temp, aes(Name, value, group=variable))+
  geom_col(aes(fill=variable)) +
  scale_fill_viridis_d("Statystyka", labels=c("Gole", "Asysty"),begin=0.5, end=1) +
  geom_text(aes(label = value), position = position_stack(vjust = 0.5)) +
  theme_minimal()+
  labs(x='Napastnik', y='Liczba bramek lub asyst', title='Najlepsi napastnicy w akcjach ofensywnych')+
  theme(axis.text.x = element_text(hjust=1, angle=45), axis.line.x = element_blank())+
  theme(legend.position = 'bottom')
```

Najlepszym napastnikiem w klasyfikacji kanadyjskiej w sezonie 2019/2020 w lidze angielskiej był Mohamed Salah. Zdobył on 29 punktów w tej klasyfikacji, z czego 19 stanowiły bramki a 10 asysty. Na drugim miejscu uplasował się Jamie Vardy, który z 23 bramkami został najlepszym strzelcem w tym sezonie. Kolejno, zostały przedstawione dwa wykresy radarowe wybranych napastników.

```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}

temp <- forwards %>%
  filter(Appearances>=10) %>%
  mutate(Goals_per_match = Goals/Appearances,
         Passes.per.match = Passes/Appearances,
         shots_per_match = Shots/Appearances,
         chances = Big.chances.created/Appearances,
         assists = Assists/Appearances,
         head = Headed.goals/Appearances)

normalize <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}

temp['Goals_per_match'] <- normalize(temp['Goals_per_match'])
temp['Passes.per.match'] <- normalize(temp['Passes.per.match'])
temp['shots_per_match'] <- normalize(temp['shots_per_match'])
temp['chances'] <- normalize(temp['chances'])
temp['assists'] <- normalize(temp['assists'])
temp['head'] <- normalize(temp['head'])

create_data_for <- function(x){
temp2 <- temp%>%
  filter(Name%in%x) %>%
  select(Goals_per_match, Passes.per.match, shots_per_match, chances, 
         assists, head,Name)
rownames(temp2) <- temp2$Name 
temp2 <- temp2[, -7]
temp2 <- rbind(rep(1, 6), rep(0,6), temp2)
colnames(temp2) <- c("Gole na mecz", "Podania na mecz", "Strzały na mecz", "Stworzone okazje na mecz",
                               "Asysty na mecz", "Gole głową na mecz")
return(temp2)

}

mst <- create_data_for(c("Mohamed Salah", "Son Heung-Min", "Tammy Abraham"))
scale_colours=c(viridis(3)[3], viridis(3)[2], magma(3)[2])
radarchart(mst, pcol=scale_colours, plwd=3, vlcex=0.7)
legend(x=1, 
       y=1.35, 
       legend = rownames(mst[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex = 0.7)
```

Na powyższym wykresie najlepiej prezentowały się statystyki Mohameda Salaha. Przewodził on w następujących kategoriach: liczba strzałów na mecz, liczba podań na mecz, czy liczba bramek na mecz. Najgorzej z wybranej trójki prezentował się Tammy Abraham, który przewodził jedynie w statystyce liczby zdobytych bramek głową na mecz. Następnie został wygenerowany wykres radarowy z trójką innych napastników.

```{r, echo=FALSE, fig.width=6.5, fig.height=6, out.width='600px'}

vgf <- create_data_for(c("Jamie Vardy", "Mason Greenwood", "Roberto Firmino"))
scale_colours=c(viridis(3)[3], viridis(3)[2], magma(3)[2])
radarchart(vgf, pcol=scale_colours, plwd=3, vlcex=0.7)
legend(x=1, 
       y=1.35, 
       legend = rownames(vgf[-c(1,2),]), 
       bty = "n", pch=20 , col = scale_colours, cex = 0.7)
```

Widać zdecydowaną różnicą w stylu gry przedstawionych powyżej napastników. Jamie Vardy był najlepszy pod względem liczby strzelonych bramek, liczby zdobytych goli głową oraz stworzonych okazji. Natomiast Roberto Firmino wyróżniał się na tle pozostałej dwójki w liczbie podań na mecz oraz asyst. Mason Greenwoow nie przewodził natomiast w żadnej z przedstawionych statystyk.

# Zakończenie

Powyższy raport zawiera obszerną analizę statystyk piłkarzy występujących w sezonie 2019/2020 w lidze angielskiej. Z pewnością analiza ta może być bardzo wartościowa dla trenerów oraz skautów planujących zmianę kadry zawodników w następnych sezonach. Umożliwi im to wybranie zawodników, którzy pasują do preferowanej przez nich taktyki oraz sposobu gry.